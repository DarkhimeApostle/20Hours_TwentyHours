# 20Timer 配置备份功能

## 功能概述

20Timer 现在支持完整的配置备份和恢复功能，包括：

- 所有技能数据（主页面和荣耀殿堂）
- 技能日记内容
- 技能分组数据
- 用户头像和侧边栏背景图片
- 用户名设置
- 技能祝贺记录

## 使用方法

### 导出配置

1. 打开应用，进入 **设置** 页面
2. 点击 **导出配置** 选项
3. 系统会自动收集所有数据并创建一个备份文件夹
4. 备份完成后会显示保存路径，并提示5秒
5. 可以点击 **复制路径** 按钮将路径复制到剪贴板

### 导入配置

1. 打开应用，进入 **设置** 页面
2. 点击 **导入配置** 选项
3. 选择之前导出的备份文件夹
4. 系统会自动验证并恢复所有数据
5. 导入完成后会提示重启应用以应用更改

## 备份文件结构

导出的备份文件夹包含以下文件：

```
20timer_backup_[时间戳]/
├── config.json          # 配置文件（包含所有技能数据和设置）
├── avatar.png           # 用户头像（如果存在）
└── drawer_bg.png        # 侧边栏背景（如果存在）
```

## 配置文件格式

`config.json` 文件包含以下数据结构：

```json
{
  "version": "1.0",
  "exportTime": "2024-01-01T12:00:00.000Z",
  "userInfo": {
    "userName": "用户名",
    "avatarPath": "avatar.png",
    "drawerBgPath": "drawer_bg.png"
  },
  "skills": {
    "mainSkills": [...],      // 主页面技能列表
    "hallOfGlorySkills": [...] // 荣耀殿堂技能列表
  },
  "diaries": {
    "技能名称": ["日记内容1", "日记内容2", ...]
  },
  "congratulatedSkills": ["技能ID1", "技能ID2", ...],
  "groups": [
    {
      "id": "分组ID",
      "name": "分组名称",
      "color": 颜色值,
      "order": 排序值
    }
  ]
}
```

## 注意事项

1. **备份位置**：备份文件保存在应用的文档目录中
2. **图片备份**：头像和背景图片会自动复制到备份文件夹中
3. **数据完整性**：导入时会验证配置文件版本和完整性
4. **重启应用**：导入完成后需要重启应用以确保所有更改生效
5. **兼容性**：当前版本支持配置文件版本 1.x

## 故障排除

### 导出失败
- 检查应用是否有足够的存储空间
- 确保图片文件存在且可访问

### 导入失败
- 确保选择了正确的备份文件夹
- 检查 `config.json` 文件是否存在且完整
- 验证配置文件版本是否兼容

### 数据不完整
- 重启应用以确保所有数据正确加载
- 检查是否有权限问题

## 技术实现

- 使用 `SharedPreferences` 存储技能数据和设置
- 使用 `path_provider` 管理文件路径
- 使用 `file_picker` 选择备份目录
- 图片文件通过文件系统直接复制
- 支持版本控制和数据验证 